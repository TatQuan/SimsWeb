@using SimsWeb.Models
@model IEnumerable<ClassSection>
@using System.Linq

@{
    bool isStudentOrFaculty = User.IsInRole("Student") || User.IsInRole("Faculty");

    ViewData["Title"] = isStudentOrFaculty?"Class":"Class Enrollments";


    Layout = isStudentOrFaculty
        ? "~/Views/Shared/_Layout.cshtml"
        : "~/Views/Shared/_AdminLayout.cshtml";
}
<h4 class="mb-3">Class Enrollments</h4>

@{
    var courses = ViewBag.Courses as List<Course>;
    int? selectedCourseId = ViewBag.SelectedCourseId;
}

<form method="get" class="mb-3">
    <label for="courseFilter">Course:</label>
    <select id="courseFilter" name="courseId" class="form-control">
        <option value="">-- All --</option>
        @if (courses != null)
        {
            foreach (var c in courses)
            {
                <option value="@c.Id" selected="@(selectedCourseId == c.Id)">
                    @c.Name
                </option>
            }
        }
    </select>
    <button type="submit" class="btn sims-btn-orange mt-2">Search</button>
</form>

<div class="card shadow-sm border-0">
    <div class="card-body p-3">
        <div class="table-responsive">
            <table class="table table-sm align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Class Code</th>
                        <th>Class Name</th>
                        <th>Course</th>
                        <th>Teacher</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (!Model.Any())
                    {
                        <tr>
                            <td colspan="6" class="text-center text-muted small py-3">
                                No class sections found.
                            </td>
                        </tr>
                    }
                    else
                    {
                        var i = 1;
                        foreach (var c in Model)
                        {
                            <tr>
                                <td>@i</td>
                                <td>@c.Code</td>
                                <td>@c.Name</td>
                                <td>@c.Course?.Name</td>
                                <td>@c.Teacher?.User?.FullName</td>

                                @{
                                    string actionText = "";

                                    if (User.IsInRole("Student") || User.IsInRole("Faculty"))
                                    {
                                        actionText = "View Student";
                                    }
                                    else if (User.IsInRole("Admin"))
                                    {
                                        actionText = "Manage Students";
                                    }
                                }

                                <td class="text-end">
                                    <a asp-controller="Enrollments"
                                       asp-action="Manage"
                                       asp-route-id="@c.Id"
                                       class="btn btn-sm btn-outline-primary">
                                        @actionText
                                    </a>
                                </td>
                            </tr>
                            i++;
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
